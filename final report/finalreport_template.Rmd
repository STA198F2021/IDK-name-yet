---
title: "CDC 500 Cities: Healthcare Access, Behaviors, and Health Outcomes"
subtitle: "Stat 198 Final Project"
author: "Maya Ghanem and Isabelle Xiong"
date: "11/1/2021"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

# Description of Data

(Include description of how you edited the data)

```{r setup, include=FALSE, echo= FALSE, message= FALSE, warning= FALSE}
knitr::opts_chunk$set(echo= TRUE) 
```

```{r load-data-packages, echo= FALSE, warning= FALSE, message= FALSE}
library(readr)
library(tidyverse)
library(readxl)
library(dplyr)
library(tidymodels)
library(patchwork)
library(plotly)
library(widgetframe)
```

```{r upload-insurance-data, echo= FALSE, message= FALSE, warning= FALSE}
insurance <- read_excel("~/ Stats 198 Project/data/insurance_500_cities.xlsx")
```

```{r upload-visits-to-doctor-data, echo= FALSE, message= FALSE, warning= FALSE}
visits_to_doctor <- read_excel("~/ Stats 198 Project/data/visits_to_doctor.xlsx")
```

```{r upload-medicine-high-bp-data, echo= FALSE, message= FALSE, warning= FALSE}
medicine_high_bp <- read_excel("~/ Stats 198 Project/data/medicine_high_bp.xlsx")
```

```{r upload-smoking-data, echo= FALSE, message= FALSE, warning= FALSE}
smoking <- read_excel("~/ Stats 198 Project/data/smoking.xlsx")
```

```{r upload-binge-drinking-data, echo= FALSE, message= FALSE, warning= FALSE}
binge_drinking <- read_excel("~/ Stats 198 Project/data/binge_drinking.xlsx")
```

```{r upload-physical-activity-data, echo= FALSE, message= FALSE, warning= FALSE}
physical_activity <- read_excel("~/ Stats 198 Project/data/physical_activity.xlsx")
```

```{r upload-heart-disease-data, echo= FALSE, message= FALSE, warning= FALSE}
heart_disease <- read_excel("~/ Stats 198 Project/data/heart_disease.xlsx")
```

```{r upload-diabetes-data, echo= FALSE, message=FALSE, warning= FALSE}
diabetes <- read_excel("~/ Stats 198 Project/data/diabetes.xlsx")
```

```{r upload-kidney-disease-data, echo= FALSE, message= FALSE, warning= FALSE}
kidney_disease <- read_excel("~/ Stats 198 Project/data/kidney_disease.xlsx")
```

```{r edit-insurance-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_insurance <- insurance %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("insurance" = mean_value)
```

```{r edit-visits-to-doctor-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_visits_to_doctor <- visits_to_doctor %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("visits_to_doctor" = mean_value)
```

```{r edit-medicine-high-bp-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_medicine_high_bp <- medicine_high_bp %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("medicine_high_bp" = mean_value)
```

```{r edit-smoking-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_smoking <- smoking %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("smoking" = mean_value)
```

```{r edit-binge-drinking-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_binge_drinking <- binge_drinking %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("binge_drinking" = mean_value)
```

```{r edit-physical-activity, echo= FALSE, message= FALSE, warning= FALSE}
edit_physical_activity <- physical_activity %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("physical_activity" = mean_value)
```

```{r edit-heart-disease-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_heart_disease <- heart_disease %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("heart_disease" = mean_value)
```

```{r edit-diabetes-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_diabetes <- diabetes %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("diabetes" = mean_value)
```

```{r edit-kidney-disease-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_kidney_disease <- kidney_disease %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("kidney_disease" = mean_value)
```

```{r join-data, echo= FALSE, warning= FALSE, message= FALSE}
data_500_cities <- edit_insurance %>%
  left_join(edit_visits_to_doctor) %>%
  left_join(edit_medicine_high_bp) %>%
  left_join(edit_smoking) %>%
  left_join(edit_binge_drinking) %>%
  left_join(edit_physical_activity) %>%
  left_join(edit_heart_disease) %>%
  left_join(edit_diabetes) %>%
  left_join(edit_kidney_disease) %>%
  select(c(StateAbbr, StateDesc, CityName, insurance, visits_to_doctor, medicine_high_bp, smoking, binge_drinking, physical_activity, heart_disease, diabetes, kidney_disease, GeoLocation))
```
# Research Questions

1) Do cities with a greater lack of healthcare access have poorer mental health and/or physical health outcomes? 

2)Does healthcare access, mental health, and/or physical health outcomes vary by state?

# Variables of Interest

## Explanatory Variables: 

1) Healthcare Access for Adults (18+): Percent of City Population that Lacks Insurance, Percent of City Population with visits to doctor for routine checkup within the past year, Percent of City Population who have high blood pressure and are taking medicine for high blood pressure control.

2) Geographic Distribution by State

## Response Variables: 

1) Behavior for Adults (18+): Percent of city population currently smoking, percent of city population currently reporting binge drinking habits, percent of city population reporting No leisure-time physical activity

2) Health Outcomes for Adults (18+): Percent of city population with coronary heart disease, percent of population diagnosed with diabetes, percent of city population with kidney disease  

# Linear Regressions

NOTE: Create regressions first between the explanatory (access) variables-- this can indicate what kind of interactions are needed.

--> insurance vs. visits to doctor
--> insurance vs. medicine
--> visits to doctor vs. medicine

NOTE: We will not do third order interactions because they are beyond the scope of this course

## Regressions for Healthcare Access and Behaviors Variables

### Fit with Interaction Variables

1) Access Variables vs. Smoking

```{r linear-regression-access-smoking, warning= FALSE, message= FALSE}
int_access_smoking_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(smoking ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_smoking_fit_aug <- augment(int_access_smoking_fit$fit)
tidy(int_access_smoking_fit) %>%
  print()
```

```{r adjusted-r-squared-access-smoking, warning= FALSE, message= FALSE}
glance(int_access_smoking_fit)$adj.r.squared %>%
  print()
```

```{r residuals-access-smoking, warning = FALSE, message= FALSE}
int_access_smoking_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted City Percentage of Smoking Adults",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage of Smokers",
    y = "Standard Residuals"
  )
```

2) Access Variables vs. Binge Drinking

```{r linear-regression-access-binge-drinking, warning= FALSE, message= FALSE}
int_access_binge_drinking_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(binge_drinking ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_binge_drinking_fit_aug <- augment(int_access_binge_drinking_fit$fit)
tidy(int_access_binge_drinking_fit) %>%
  print()
```

```{r adjusted-r-squared-access-binge-drinking, warning= FALSE, message= FALSE}
glance(int_access_binge_drinking_fit)$adj.r.squared %>%
  print()
```

```{r residuals-access-binge-drinking, warning = FALSE, message= FALSE}
int_access_binge_drinking_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted Percentage of City Reporting Binge Drinking",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage of Adults Reporting Binge Drinking",
    y = "Standard Residuals"
  )
```

3) Access Variables vs. Physical Activity

```{r linear-regression-access-physical-activity, warning= FALSE, message= FALSE}
int_access_physical_activity_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(physical_activity ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_physical_activity_fit_aug <- augment(int_access_physical_activity_fit$fit)
tidy(int_access_physical_activity_fit) %>%
  print()
```

```{r adjusted-r-squared-access-physical-activity, warning= FALSE, message= FALSE}
glance(int_access_physical_activity_fit)$adj.r.squared %>%
  print()
```

```{r residuals-access-physical-activity, warning = FALSE, message= FALSE}
int_access_physical_activity_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted Percentage of City Reporting No Physical Activity",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage Reporting No Lesisure Time Physical Activity",
    y = "Standard Residuals"
  )
```

## Regressions for Healthcare Access and Health Outcomes

### Fit with Interaction Variables

4) Access Variables vs. Heart Disease

```{r linear-regression-access-heart-disease, warning= FALSE, message= FALSE}
int_access_heart_disease_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(heart_disease ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_heart_disease_fit_aug <- augment(int_access_heart_disease_fit$fit)
tidy(int_access_heart_disease_fit) %>%
  print()
```

```{r adjusted-r-squared-access-heart-disease, warning= FALSE, message= FALSE}
glance(int_access_heart_disease_fit)$adj.r.squared %>%
  print()
```

```{r residuals-access-heart-disease, warning = FALSE, message= FALSE}
int_access_heart_disease_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted City Percentage of Adults with Coronary Heart Disease",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage of Adults with Coronary Heart Disease",
    y = "Standard Residuals"
  )
```

NOTE: A linear regression is not fitting for this relationship because there is a significant pattern in the residual plot.

5) Access Variables vs. Diabetes

```{r linear-regression-access-diabetes, warning= FALSE, message= FALSE}
int_access_diabetes_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(diabetes ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_diabetes_fit_aug <- augment(int_access_diabetes_fit$fit)
tidy(int_access_diabetes_fit) %>%
  print()
```

```{r adjusted-r-squared-access-diabetes, warning= FALSE, message= FALSE}
glance(int_access_diabetes_fit)$adj.r.squared %>%
  print()
```

```{r residuals-access-diabetes, warning = FALSE, message= FALSE}
int_access_diabetes_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted City Percentage of Adults with Diabetes",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage of Adults with Diabetes",
    y = "Standard Residuals"
  )
```

6) Access Variables vs. Kidney Disease

```{r linear-regression-access-kidney-disease, warning= FALSE, message= FALSE}
int_access_kidney_disease_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(kidney_disease ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_kidney_disease_fit_aug <- augment(int_access_kidney_disease_fit$fit)
tidy(int_access_kidney_disease_fit) %>%
  print()
```

```{r adjusted-r-squared-access-kidney-disease, warning= FALSE, message= FALSE}
glance(int_access_kidney_disease_fit)$adj.r.squared %>%
  print()
```

```{r residuals-access-kidney-disease, warning = FALSE, message= FALSE}
int_access_kidney_disease_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted City Percentage of Adults with Kidney Disease",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage of Adults with Diabetes",
    y = "Standard Residuals"
  )
```

NOTE: A linear regression is not fitting for this relationship because there is a significant pattern in the residual plot.

## Regression With Most Correlated Variables

# ANOVA Testing

## Initial Visualizations

## Does (Insert Variable) Have Variation Across States?