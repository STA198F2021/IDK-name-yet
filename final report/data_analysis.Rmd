---
title: "CDC 500 Cities: Healthcare Access, Behaviors, and Health Outcomes"
subtitle: "Stat 198 Final Project"
author: "Maya Ghanem and Isabelle Xiong"
date: "11/1/2021"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

# Description of Data

(Include description of how you edited the data)

```{r setup, include=FALSE, echo= FALSE, message= FALSE, warning= FALSE}
knitr::opts_chunk$set(echo= TRUE) 
```

```{r load-data-packages, echo= FALSE, warning= FALSE, message= FALSE}
library(readr)
library(tidyverse)
library(readxl)
library(dplyr)
library(tidymodels)
library(patchwork)
library(plotly)
library(widgetframe)
library(here)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(rgeos)
```

```{r upload-insurance-data, echo= FALSE, message= FALSE, warning= FALSE}
insurance <- read_excel(here("data/insurance_500_cities.xlsx"))
```

```{r upload-visits-to-doctor-data, echo= FALSE, message= FALSE, warning= FALSE}
visits_to_doctor <- read_excel(here("data/visits_to_doctor.xlsx"))
```

```{r upload-medicine-high-bp-data, echo= FALSE, message= FALSE, warning= FALSE}
medicine_high_bp <- read_excel(here("data/medicine_high_bp.xlsx"))
```

```{r upload-smoking-data, echo= FALSE, message= FALSE, warning= FALSE}
smoking <- read_excel(here("data/smoking.xlsx"))
```

```{r upload-binge-drinking-data, echo= FALSE, message= FALSE, warning= FALSE}
binge_drinking <- read_excel(here("data/binge_drinking.xlsx"))
```

```{r upload-physical-activity-data, echo= FALSE, message= FALSE, warning= FALSE}
physical_activity <- read_excel(here("data/physical_activity.xlsx"))
```

```{r upload-heart-disease-data, echo= FALSE, message= FALSE, warning= FALSE}
heart_disease <- read_excel(here("data/heart_disease.xlsx"))
```

```{r upload-diabetes-data, echo= FALSE, message=FALSE, warning= FALSE}
diabetes <- read_excel(here("data/diabetes.xlsx"))
```

```{r upload-kidney-disease-data, echo= FALSE, message= FALSE, warning= FALSE}
kidney_disease <- read_excel(here("data/kidney_disease.xlsx"))
```

```{r edit-insurance-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_insurance <- insurance %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("insurance" = mean_value)
```

```{r edit-visits-to-doctor-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_visits_to_doctor <- visits_to_doctor %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("visits_to_doctor" = mean_value)
```

```{r edit-medicine-high-bp-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_medicine_high_bp <- medicine_high_bp %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("medicine_high_bp" = mean_value)
```

```{r edit-smoking-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_smoking <- smoking %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("smoking" = mean_value)
```

```{r edit-binge-drinking-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_binge_drinking <- binge_drinking %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("binge_drinking" = mean_value)
```

```{r edit-physical-activity, echo= FALSE, message= FALSE, warning= FALSE}
edit_physical_activity <- physical_activity %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("physical_activity" = mean_value)
```

```{r edit-heart-disease-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_heart_disease <- heart_disease %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("heart_disease" = mean_value)
```

```{r edit-diabetes-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_diabetes <- diabetes %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("diabetes" = mean_value)
```

```{r edit-kidney-disease-data, echo= FALSE, message= FALSE, warning= FALSE}
edit_kidney_disease <- kidney_disease %>%
  select(StateAbbr, StateDesc, CityName, Data_Value_Type, Data_Value, GeoLocation) %>%
  filter(Data_Value_Type %in% c("Age-adjusted prevalence")) %>%
  group_by(CityName) %>%
  mutate(mean_value = mean(Data_Value)) %>%
  select(StateAbbr, StateDesc, CityName, mean_value, GeoLocation) %>%
  distinct(CityName, .keep_all = TRUE) %>%
  rename("kidney_disease" = mean_value)
```

```{r join-data, echo= FALSE, warning= FALSE, message= FALSE}
data_500_cities <- edit_insurance %>%
  left_join(edit_visits_to_doctor) %>%
  left_join(edit_medicine_high_bp) %>%
  left_join(edit_smoking) %>%
  left_join(edit_binge_drinking) %>%
  left_join(edit_physical_activity) %>%
  left_join(edit_heart_disease) %>%
  left_join(edit_diabetes) %>%
  left_join(edit_kidney_disease) %>%
  select(c(StateAbbr, StateDesc, CityName, insurance, visits_to_doctor, medicine_high_bp, smoking, binge_drinking, physical_activity, heart_disease, diabetes, kidney_disease, GeoLocation))
```
# Research Questions

1) Do cities with a greater lack of healthcare access have poorer mental health and/or physical health outcomes? 

2)Does healthcare access, mental health, and/or physical health outcomes vary by state?

# Variables of Interest

## Explanatory Variables: 

1) Healthcare Access for Adults (18+): Percent of City Population that Lacks Insurance, Percent of City Population with visits to doctor for routine checkup within the past year, Percent of City Population who have high blood pressure and are taking medicine for high blood pressure control.

2) Geographic Distribution by State

## Response Variables: 

1) Behavior for Adults (18+): Percent of city population currently smoking, percent of city population currently reporting binge drinking habits, percent of city population reporting No leisure-time physical activity

2) Health Outcomes for Adults (18+): Percent of city population with coronary heart disease, percent of population diagnosed with diabetes, percent of city population with kidney disease  

# Linear Regressions

New Method:

a) Run correlations between the explanatory variables
b) Run linear regressions and adjusted r squared values
c) Assess which regression is better
d) Run the residual plot and the graph

## Correlations between Explanatory Variables

```{r correlation-insurance-doctor, warning= FALSE, message= FALSE}
data_500_cities %>%
  ggplot(mapping = aes(x = insurance, y = visits_to_doctor)) +
  geom_point() +
  labs(
    title = "Relationship Between Lack of Insurance and Visits to Doctor",
    subtitle = "Data from CDC 500 Cities",
    x = "Percent Lack of Insurance",
    y = "Percent Visiting Doctor within 6 months"
  )
```

There does not seem to be any significant correlation.

```{r correlation-insurance-bp-meds, warning= FALSE, message= FALSE}
data_500_cities %>%
  ggplot(mapping = aes(x = insurance, y = medicine_high_bp)) +
  geom_point() +
  labs(
    title = "Relationship Between Lack of Insurance and Percent Pop Taking BP Meds",
    subtitle = "Data from CDC 500 Cities",
    x = "Percent Lack of Insurance",
    y = "Percent Taking Medications for High Blood Pressure"
  )
```

There does not seem to be any significant correlation.

```{r correlation-visits-to-doctor-bp-meds, warning= FALSE, message= FALSE}
data_500_cities %>%
  ggplot(mapping = aes(x = visits_to_doctor, y = medicine_high_bp)) +
  geom_point() +
  labs(
    title = "Relationship Between Visits to Doctor and Percent Pop Taking BP Meds",
    subtitle = "Data from CDC 500 Cities",
    x = "Percent Visits to Doctor within the Past 6 Months",
    y = "Percent Taking Medications for High Blood Pressure"
  )
```

There seems to be a significant correlation between Visits to Doctor and Taking Medications.

As a result, I will test three models: one with no interaction variables, one with only one interaction variable (Visits_to_Doctor * medicine_high_bp), and one with all three interaction variables.

## Access Variables vs. Smoking

### Running Linear Regressions

Linear Regression with No Interaction Variables:

```{r linear-regression-access-smoking_no_int, warning= FALSE, message= FALSE}
access_smoking_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(smoking ~ insurance + visits_to_doctor + medicine_high_bp, data = data_500_cities)
access_smoking_fit_aug <- augment(access_smoking_fit$fit)
tidy(access_smoking_fit) %>%
  print()
```

Linear Regression with one interaction variable:

```{r linear-regression-access-smoking_one_int, warning= FALSE, message= FALSE}
one_access_smoking_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(smoking ~ insurance + visits_to_doctor + medicine_high_bp + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
one_access_smoking_fit_aug <- augment(one_access_smoking_fit$fit)
tidy(one_access_smoking_fit) %>%
  print()
```

Linear Regression with All Interaction Variables
```{r linear-regression-access-smoking-int, warning= FALSE, message= FALSE}
int_access_smoking_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(smoking ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_smoking_fit_aug <- augment(int_access_smoking_fit$fit)
tidy(int_access_smoking_fit) %>%
  print()
```

### Comparing Adj R-Squared Values

Adj R-Squared Value with No Interactions: 

```{r adjusted-r-squared-access-smoking_no_int, warning= FALSE, message= FALSE}
glance(access_smoking_fit)$adj.r.squared %>%
  print()
```

Adj R-Squared Value with One Interactions:

```{r adjusted-r-squared-access-smoking_one_int, warning= FALSE, message= FALSE}
glance(one_access_smoking_fit)$adj.r.squared %>%
  print()
```

Adj R-Squared Value with All Interactions:

```{r adjusted-r-squared-access-smoking-all-int, warning= FALSE, message= FALSE}
glance(int_access_smoking_fit)$adj.r.squared %>%
  print()
```

Make some kind of statement here about which regression is most appropriate

### Displaying Graphs (Edit Based on Which Interaction is Most Appropriate)

Residual Graph (Note any patterns)

```{r residuals-access-smoking_no_int, warning = FALSE, message= FALSE}
access_smoking_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted City Percentage of Smoking Adults",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage of Smokers",
    y = "Standard Residuals"
  )
```

Graph Between Explanatory and Response Variables

```{r graph-regression-access-smoking-no-int, warning= FALSE, message= FALSE}
data_500_cities %>%
ggplot( mapping = aes(x = insurance, y = smoking)) + 
geom_point(size = 0.25) +
geom_smooth(method = "lm", data = access_smoking_fit_aug, mapping = aes(x = insurance, y = .fitted))
```

## Access Variables vs. Binge Drinking

### Running Linear Regressions

Linear Regression for  no interactions:

```{r linear-regression-access-binge-drinking-no-int, warning= FALSE, message= FALSE}
access_binge_drinking_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(binge_drinking ~ insurance + visits_to_doctor + medicine_high_bp, data = data_500_cities)
access_binge_drinking_fit_aug <- augment(access_binge_drinking_fit$fit)
tidy(access_binge_drinking_fit) %>%
  print()
```

Linear regression with one interaction:

```{r linear-regression-access-binge-drinking-one-int, warning= FALSE, message= FALSE}
one_access_binge_drinking_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(binge_drinking ~ insurance + visits_to_doctor + medicine_high_bp + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
one_access_binge_drinking_fit_aug <- augment(one_access_binge_drinking_fit$fit)
tidy(one_access_binge_drinking_fit) %>%
  print()
```

Linear regression with all interactions: 

```{r linear-regression-access-binge-drinking-int, warning= FALSE, message= FALSE}
int_access_binge_drinking_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(binge_drinking ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_binge_drinking_fit_aug <- augment(int_access_binge_drinking_fit$fit)
tidy(int_access_binge_drinking_fit) %>%
  print()
```


### Comparing Adj R-Squared Values

Adj R-squared value for regression with no interactions:

```{r adjusted-r-squared-access-binge-drinking-no-int, warning= FALSE, message= FALSE}
glance(access_binge_drinking_fit)$adj.r.squared %>%
  print()
```

Adj R-squared value for regression with one interaction:

```{r adjusted-r-squared-access-binge-drinking-one-int, warning= FALSE, message= FALSE}
glance(one_access_binge_drinking_fit)$adj.r.squared %>%
  print()
```

Adj R-squared value for regression with all interactions:

```{r adjusted-r-squared-access-binge-drinking-all-int, warning= FALSE, message= FALSE}
glance(int_access_binge_drinking_fit)$adj.r.squared %>%
  print()
```

Make some kind of statement about which linear regression is most apporpriate

### Displaying Graphs (Edit Based on which regression you choose)

Residual Graph (Note any patterns)

```{r residuals-access-binge-drinking-no-int, warning = FALSE, message= FALSE}
access_binge_drinking_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted Percentage of City Reporting Binge Drinking",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage of Adults Reporting Binge Drinking",
    y = "Standard Residuals"
  )
```

Graph Comparing Explanatory and Response Variables

```{r graph-regression-access-binge-drinking-no-int, warning= FALSE, message= FALSE}
data_500_cities %>%
ggplot( mapping = aes(x = insurance, y = binge_drinking)) + 
geom_point(size = 0.25) +
geom_smooth(data = access_binge_drinking_fit_aug, mapping = aes(x = insurance, y = .fitted))
```

## Access Variables vs. Physical Activity

### Running Linear Regressions

Linear regression with no interactions

```{r linear-regression-access-physical-activity-no-int, warning= FALSE, message= FALSE}
access_physical_activity_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(physical_activity ~ insurance + visits_to_doctor + medicine_high_bp, data = data_500_cities)
access_physical_activity_fit_aug <- augment(access_physical_activity_fit$fit)
tidy(access_physical_activity_fit) %>%
  print()
```

Linear regression with one interaction

```{r linear-regression-access-physical-activity-one-int, warning= FALSE, message= FALSE}
one_access_physical_activity_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(physical_activity ~ insurance + visits_to_doctor + medicine_high_bp + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
one_access_physical_activity_fit_aug <- augment(one_access_physical_activity_fit$fit)
tidy(one_access_physical_activity_fit) %>%
  print()
```

Linear regression with all interactions

```{r linear-regression-access-physical-activity-all-int, warning= FALSE, message= FALSE}
int_access_physical_activity_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(physical_activity ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_physical_activity_fit_aug <- augment(int_access_physical_activity_fit$fit)
tidy(int_access_physical_activity_fit) %>%
  print()
```

### Comparing Adj R-Squared Values

Adj R-squared value for regression with no interactions

```{r adjusted-r-squared-access-physical-activity-no-int, warning= FALSE, message= FALSE}
glance(access_physical_activity_fit)$adj.r.squared %>%
  print()
```

Adj R-squared value for regression with one interaction

```{r adjusted-r-squared-access-physical-activity-one-int, warning= FALSE, message= FALSE}
glance(one_access_physical_activity_fit)$adj.r.squared %>%
  print()
```

Adj R-squared value for regression with all interactions

```{r adjusted-r-squared-access-physical-activity-all-int, warning= FALSE, message= FALSE}
glance(int_access_physical_activity_fit)$adj.r.squared %>%
  print()
```

Make some kind of statement about which regression is most appropriate

### Displaying Graphs (Edit based on which regression you choose)

Residual Graph (Note any patterns)

```{r residuals-access-physical-activity-no-int, warning = FALSE, message= FALSE}
access_physical_activity_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted Percentage of City Reporting No Physical Activity",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage Reporting No Lesisure Time Physical Activity",
    y = "Standard Residuals"
  )
```

Graph Comparing Explanatory and Response Variables

```{r graph-regression-access-physical-activity-no-int, warning= FALSE, message= FALSE}
data_500_cities %>%
ggplot( mapping = aes(x = insurance, y = physical_activity)) + 
geom_point(size = 0.25) +
geom_smooth(method = "lm", data = access_physical_activity_fit_aug, mapping = aes(x = insurance, y = .fitted))
```

## Access Variables vs. Coronary Heart Disease

### Running Linear Regressions

Linear regression with no interactions:

```{r linear-regression-access-heart-disease-no-int, warning= FALSE, message= FALSE}
access_heart_disease_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(heart_disease ~ insurance + visits_to_doctor + medicine_high_bp, data = data_500_cities)
access_heart_disease_fit_aug <- augment(access_heart_disease_fit$fit)
tidy(access_heart_disease_fit) %>%
  print()
```

Linear regression with one interaction

```{r linear-regression-access-heart-disease-one-int, warning= FALSE, message= FALSE}
one_access_heart_disease_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(heart_disease ~ insurance + visits_to_doctor + medicine_high_bp + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
access_heart_disease_fit_aug <- augment(access_heart_disease_fit$fit)
tidy(access_heart_disease_fit) %>%
  print()
```

Linear regression with all interactions

```{r linear-regression-access-heart-disease-int, warning= FALSE, message= FALSE}
int_access_heart_disease_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(heart_disease ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_heart_disease_fit_aug <- augment(int_access_heart_disease_fit$fit)
tidy(int_access_heart_disease_fit) %>%
  print()
```

### Comparing Adj R Squared Values

Adj R-squared values for regression with no interactions

```{r adjusted-r-squared-access-heart-disease-no-int, warning= FALSE, message= FALSE}
glance(access_heart_disease_fit)$adj.r.squared %>%
  print()
```

Adj R-squared values for regression with one interaction

```{r adjusted-r-squared-access-heart-disease-one-int, warning= FALSE, message= FALSE}
glance(one_access_heart_disease_fit)$adj.r.squared %>%
  print()
```

Adj R-squared values for regression with all interactions

```{r adjusted-r-squared-access-heart-disease-int, warning= FALSE, message= FALSE}
glance(int_access_heart_disease_fit)$adj.r.squared %>%
  print()
```

### Displaying Graphs (Edit based on which regression you choose)

Residual Graphs (Note any Patterns)

```{r residuals-access-heart-disease-no-int, warning = FALSE, message= FALSE}
access_heart_disease_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted City Percentage of Adults with Coronary Heart Disease",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage of Adults with Coronary Heart Disease",
    y = "Standard Residuals"
  )
```

Graph Comparing Explanatory and Response Variables

## Access Variables vs. Diabetes

### Running linear regressions

Linear regression with one interaction

```{r linear-regression-access-diabetes-no-int, warning= FALSE, message= FALSE}
access_diabetes_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(diabetes ~ insurance + visits_to_doctor + medicine_high_bp, data = data_500_cities)
access_diabetes_fit_aug <- augment(access_diabetes_fit$fit)
tidy(access_diabetes_fit) %>%
  print()
```

Linear regression with one interaction

```{r linear-regression-access-diabetes-one-int, warning= FALSE, message= FALSE}
one_access_diabetes_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(diabetes ~ insurance + visits_to_doctor + medicine_high_bp + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
access_diabetes_fit_aug <- augment(access_diabetes_fit$fit)
tidy(access_diabetes_fit) %>%
  print()
```

Linear regression with all interactions

```{r linear-regression-access-diabetes-int, warning= FALSE, message= FALSE}
int_access_diabetes_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(diabetes ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_diabetes_fit_aug <- augment(int_access_diabetes_fit$fit)
tidy(int_access_diabetes_fit) %>%
  print()
```

### Comparing Adj R-Squared Values

Adj R-squared value for regression with no interactions

```{r adjusted-r-squared-access-diabetes-no-int, warning= FALSE, message= FALSE}
glance(access_diabetes_fit)$adj.r.squared %>%
  print()
```

Adj R-squared value for regression with one interaction

```{r adjusted-r-squared-access-diabetes-one-int, warning= FALSE, message= FALSE}
glance(one_access_diabetes_fit)$adj.r.squared %>%
  print()
```

Adj R-squared value for regression with all interactions

```{r adjusted-r-squared-access-diabetes-int, warning= FALSE, message= FALSE}
glance(int_access_diabetes_fit)$adj.r.squared %>%
  print()
```

### Dosplaying Graphs (Edit based on which regression you choose)

Residual Graph (Note any patterns)
```{r residuals-access-diabetes-no-int, warning = FALSE, message= FALSE}
access_diabetes_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted City Percentage of Adults with Diabetes",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage of Adults with Diabetes",
    y = "Standard Residuals"
  )
```

Graph comparing explanatory and response variables

## Access Variables vs. Kidney Disease

### Running Linear Regression Models

Linear Regression Model with no interactions

```{r linear-regression-access-kidney-disease-no-int, warning= FALSE, message= FALSE}
access_kidney_disease_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(kidney_disease ~ insurance + visits_to_doctor + medicine_high_bp, data = data_500_cities)
access_kidney_disease_fit_aug <- augment(access_kidney_disease_fit$fit)
tidy(access_kidney_disease_fit) %>%
  print()
```

Linear regression model with one interaction

```{r linear-regression-access-kidney-disease-one-int, warning= FALSE, message= FALSE}
one_access_kidney_disease_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(kidney_disease ~ insurance + visits_to_doctor + medicine_high_bp + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
one_access_kidney_disease_fit_aug <- augment(one_access_kidney_disease_fit$fit)
tidy(one_access_kidney_disease_fit) %>%
  print()
```

Linear regression model with all interactions

```{r linear-regression-access-kidney-disease-int, warning= FALSE, message= FALSE}
int_access_kidney_disease_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(kidney_disease ~ insurance + visits_to_doctor + medicine_high_bp + (insurance * visits_to_doctor) + (insurance * medicine_high_bp) + (visits_to_doctor * medicine_high_bp), data = data_500_cities)
int_access_kidney_disease_fit_aug <- augment(int_access_kidney_disease_fit$fit)
tidy(int_access_kidney_disease_fit) %>%
  print()
```
 
### Comparing Adj R-Squared Values

Adj R-squared value for regression with no interactions

```{r adjusted-r-squared-access-kidney-disease-no-int, warning= FALSE, message= FALSE}
glance(access_kidney_disease_fit)$adj.r.squared %>%
  print()
```

Adj R-squared value for regression with one interaction

```{r adjusted-r-squared-access-kidney-disease-one-int, warning= FALSE, message= FALSE}
glance(one_access_kidney_disease_fit)$adj.r.squared %>%
  print()
```

Adj R-squared value for regression with all interactions

```{r adjusted-r-squared-access-kidney-disease-int, warning= FALSE, message= FALSE}
glance(int_access_kidney_disease_fit)$adj.r.squared %>%
  print()
```

Displaying Graphs:

Residual Graph (Note any patterns)
```{r residuals-access-kidney-disease-no-int, warning = FALSE, message= FALSE}
access_kidney_disease_fit_aug %>%
  ggplot(mapping = aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 0, color = "purple", lty = "dashed") + 
  labs(
    title = "Residuals vs. Predicted City Percentage of Adults with Kidney Disease",
    subtitle = "Data From CDC 500 Cities",
    x = "Predicted Percentage of Adults with Diabetes",
    y = "Standard Residuals"
  )
```

Graph Comparing Explanatory and Response Variables

# ANOVA Testing

## Initial Visualizations

NOTE: Use initial visualizations to check if assumptions of ANOVA are met!

## Overall Tests

```{r ANOVA-insurance-state, warning= FALSE, message= FALSE}
summary(aov(insurance~StateDesc,data=data_500_cities)) %>%
  print()
```

```{r ANOVA-visits-to-doctor-state, warning= FALSE, message= FALSE}
summary(aov(visits_to_doctor~StateDesc,data=data_500_cities)) %>%
  print()
```

```{r ANOVA-medicine-high-bp-state, warning= FALSE, message= FALSE}
summary(aov(medicine_high_bp~StateDesc,data=data_500_cities)) %>%
  print()
```

```{r ANOVA-smoking-state, warning= FALSE, message= FALSE}
summary(aov(smoking~StateDesc,data=data_500_cities)) %>%
  print()
```

```{r ANOVA-binge-drinking-state, warning= FALSE, message= FALSE}
summary(aov(binge_drinking~StateDesc,data=data_500_cities)) %>%
  print()
```

```{r ANOVA-physical-activity-state, warning= FALSE, message= FALSE}
summary(aov(physical_activity~StateDesc,data=data_500_cities)) %>%
  print()
```

```{r ANOVA-heart-disease-state, warning= FALSE, message= FALSE}
summary(aov(heart_disease~StateDesc,data=data_500_cities)) %>%
  print()
```

```{r ANOVA-diabetes-state, warning= FALSE, message= FALSE}
summary(aov(diabetes~StateDesc,data=data_500_cities)) %>%
  print()
```

```{r ANOVA-kidney-disease-state, warning= FALSE, message= FALSE}
summary(aov(kidney_disease~StateDesc,data=data_500_cities)) %>%
  print()
```

It seems like pretty much all the overall tests indicate significant variance across the groups.

## Step Down Tests

```{r step-down-insurance-state, warning= FALSE, message= FALSE}
insurance_state_pair <- pairwise.t.test(data_500_cities$insurance,    data_500_cities$StateDesc, p.adj = "holm")
sig_ins_state_pairs <- broom::tidy(insurance_state_pair) %>%
  filter(p.value<0.05) %>%
  arrange(group1,group2)
nrow(sig_ins_state_pairs)
print(sig_ins_state_pairs)
```

The overall ANOVA test says there is a significance but the Step Down stests show no significant pairs?

```{r step-down-doctor-state, warning= FALSE, message= FALSE}
doctor_state_pair <- pairwise.t.test(data_500_cities$visits_to_doctor,    data_500_cities$StateDesc, p.adj = "holm")
sig_doctor_state_pairs <- broom::tidy(doctor_state_pair) %>%
  filter(p.value<0.05) %>%
  arrange(group1,group2)
nrow(sig_doctor_state_pairs)
print(sig_doctor_state_pairs)
```

Ok so there is clearly an issue. I think I am interpreting the F-statistic incorrectly?

```{r step-down-smoking-state, warning= FALSE, message= FALSE}
smoking_state_pair <- pairwise.t.test(data_500_cities$smoking,    data_500_cities$StateDesc, p.adj = "holm")
sig_smoking_state_pairs <- broom::tidy(smoking_state_pair) %>%
  filter(p.value<0.05) %>%
  arrange(group1,group2)
nrow(sig_smoking_state_pairs)
print(sig_smoking_state_pairs)
```

### Map Visualization
